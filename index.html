<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Virtual Plant Care Simulator</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f0f0f0; }
        #canvas { border: 1px solid #000; background: #87ceeb; }
        #controls, #dashboard { margin-top: 10px; padding: 10px; background: #fff; border-radius: 5px; }
        button { padding: 5px 10px; margin: 2px; }
    </style>
</head>
<body>
    <h1>Virtual Plant Care Simulator</h1>
    <canvas id="canvas" width="400" height="400"></canvas>
    <div id="controls">
        <button onclick="care('water')">Water</button>
        <button onclick="care('sunlight')">Sunlight</button>
        <button onclick="care('soil')">Improve Soil</button>
        <button onclick="care('pest')">Control Pests</button>
    </div>
    <div id="dashboard"></div>

    <script type="text/javascript">
        let pyodide;
        let plantStage = 0; // 0: seed, 1: sprout, 2: mature
        let stats = { water: 50, sunlight: 50, soil: 50, pestRisk: 20 };
        let weather = 'sunny';
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        async function loadPyodideAndRun() {
            pyodide = await loadPyodide();
            await pyodide.runPythonAsync(`
import random

def apply_care(action, stats):
    if action == 'water':
        stats['water'] = min(100, stats['water'] + 20)
    elif action == 'sunlight':
        stats['sunlight'] = min(100, stats['sunlight'] + 20)
    elif action == 'soil':
        stats['soil'] = min(100, stats['soil'] + 20)
    elif action == 'pest':
        stats['pestRisk'] = max(0, stats['pestRisk'] - 20)
    update_stats(stats)

def update_weather():
    weathers = ['sunny', 'rainy', 'cloudy']
    return random.choice(weathers)

def update_growth(stats):
    growth_factor = (stats['water'] + stats['sunlight'] + stats['soil']) / 3 - stats['pestRisk'] * 0.5
    if growth_factor > 70 and stats['water'] > 30 and stats['sunlight'] > 30 and stats['soil'] > 30:
        return 2  # Mature
    elif growth_factor > 40:
        return 1  # Sprout
    return 0  # Seed

def update_stats(stats):
    stats['water'] = max(0, stats['water'] - 1)
    stats['sunlight'] = max(0, stats['sunlight'] - 1)
    stats['soil'] = max(0, stats['soil'] - 1)
    stats['pestRisk'] = min(100, stats['pestRisk'] + 1)
            `);
            drawPlant(); // Draw plant immediately after Pyodide loads
            updateDashboard();
        }

        function drawPlant() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const x = canvas.width / 2;
            const y = canvas.height - 50;

            if (plantStage === 0) {  // Seed
                ctx.fillStyle = '#8B4513';
                ctx.beginPath();
                ctx.arc(x, y, 10, 0, 2 * Math.PI);
                ctx.fill();
            } else if (plantStage === 1) {  // Sprout
                ctx.fillStyle = '#228B22';
                ctx.fillRect(x - 5, y - 20, 10, 20);
                ctx.beginPath();
                ctx.arc(x, y - 25, 5, 0, 2 * Math.PI);
                ctx.fill();
            } else if (plantStage === 2) {  // Mature
                ctx.fillStyle = '#228B22';
                ctx.fillRect(x - 10, y - 40, 20, 40);
                ctx.beginPath();
                ctx.arc(x, y - 45, 10, 0, 2 * Math.PI);
                ctx.fill();
            }
        }

        function updateWeather() {
            weather = pyodide.globals.update_weather();
            updateDashboard();
        }

        function care(action) {
            pyodide.globals.apply_care(action, stats);
            plantStage = pyodide.globals.update_growth(stats);
            drawPlant();
            updateDashboard();
        }

        function updateDashboard() {
            document.getElementById('dashboard').innerText = 
                `Weather: ${weather}\nStats: Water: ${stats.water}%, Sunlight: ${stats.sunlight}%, Soil: ${stats.soil}%, Pest Risk: ${stats.pestRisk}%`;
        }

        // Initialize the app
        loadPyodideAndRun().then(() => {
            setInterval(updateWeather, 5000); // Update weather every 5 seconds
        }).catch((error) => console.error("Error loading Pyodide:", error));
    </script>
</body>
</html>
