<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Plant Care Simulator</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 20px;
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            animation: fadeIn 1s ease-out;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            background: linear-gradient(to right, #7CFC00, #98FB98, #00FF7F);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .game-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .canvas-container {
            flex: 1;
            min-width: 400px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            animation: slideInLeft 0.8s ease-out;
        }
        
        .canvas-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        #weather-display {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
        }
        
        #plant-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: #98FB98;
        }
        
        #canvas-wrapper {
            position: relative;
            width: 100%;
            height: 400px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }
        
        #canvas {
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #87CEEB, #E0F7FA);
        }
        
        .controls-container {
            flex: 1;
            min-width: 300px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            animation: slideInRight 0.8s ease-out;
        }
        
        .controls-header {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.5rem;
            color: #98FB98;
        }
        
        .care-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .care-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .care-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
            border-color: #98FB98;
        }
        
        .care-btn i {
            font-size: 2.5rem;
        }
        
        .care-btn.water i { color: #1E90FF; }
        .care-btn.sunlight i { color: #FFD700; }
        .care-btn.soil i { color: #8B4513; }
        .care-btn.pest i { color: #FF4500; }
        
        .dashboard {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            animation: fadeIn 1.2s ease-out;
        }
        
        .dashboard h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #98FB98;
            font-size: 1.4rem;
        }
        
        .stat {
            margin-bottom: 15px;
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .stat-label {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .progress-container {
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .water-progress { background: linear-gradient(to right, #1E90FF, #00BFFF); }
        .sunlight-progress { background: linear-gradient(to right, #FF8C00, #FFD700); }
        .soil-progress { background: linear-gradient(to right, #8B4513, #A0522D); }
        .pest-progress { background: linear-gradient(to right, #FF4500, #FF6347); }
        
        .stage-indicator {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
        }
        
        .stage {
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            flex: 1;
            opacity: 0.5;
            transition: all 0.3s ease;
        }
        
        .stage.active {
            opacity: 1;
            background: rgba(152, 251, 152, 0.2);
            transform: scale(1.05);
        }
        
        .stage i {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            margin-top: 20px;
            font-size: 0.9rem;
        }
        
        .message {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
        }
        
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .loader {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid #98FB98;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideInLeft {
            from { transform: translateX(-50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideInRight {
            from { transform: translateX(50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @media (max-width: 768px) {
            .game-container {
                flex-direction: column;
            }
            
            .care-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="loader"></div>
        <p>Loading Pyodide environment...</p>
        <p>This may take a moment</p>
    </div>

    <div class="container">
        <header>
            <h1><i class="fas fa-seedling"></i> Virtual Plant Care Simulator</h1>
            <p class="subtitle">Nurture your digital plant to full growth with water, sunlight, soil care, and pest control</p>
        </header>
        
        <div class="game-container">
            <div class="canvas-container">
                <div class="canvas-header">
                    <div id="plant-name">Sunflower</div>
                    <div id="weather-display">
                        <i class="fas fa-sun"></i>
                        <span>Sunny</span>
                    </div>
                </div>
                <div id="canvas-wrapper">
                    <canvas id="canvas" width="600" height="400"></canvas>
                </div>
            </div>
            
            <div class="controls-container">
                <h2 class="controls-header">Plant Care Controls</h2>
                
                <div class="care-buttons">
                    <div class="care-btn water" onclick="care('water')">
                        <i class="fas fa-tint"></i>
                        <div>Water Plant</div>
                    </div>
                    <div class="care-btn sunlight" onclick="care('sunlight')">
                        <i class="fas fa-sun"></i>
                        <div>Give Sunlight</div>
                    </div>
                    <div class="care-btn soil" onclick="care('soil')">
                        <i class="fas fa-seedling"></i>
                        <div>Improve Soil</div>
                    </div>
                    <div class="care-btn pest" onclick="care('pest')">
                        <i class="fas fa-bug"></i>
                        <div>Control Pests</div>
                    </div>
                </div>
                
                <div class="dashboard">
                    <h3>Plant Health Dashboard</h3>
                    
                    <div class="stat">
                        <div class="stat-header">
                            <div class="stat-label">
                                <i class="fas fa-tint"></i>
                                <span>Water Level</span>
                            </div>
                            <span id="water-value">50%</span>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar water-progress" id="water-bar" style="width: 50%"></div>
                        </div>
                    </div>
                    
                    <div class="stat">
                        <div class="stat-header">
                            <div class="stat-label">
                                <i class="fas fa-sun"></i>
                                <span>Sunlight</span>
                            </div>
                            <span id="sunlight-value">50%</span>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar sunlight-progress" id="sunlight-bar" style="width: 50%"></div>
                        </div>
                    </div>
                    
                    <div class="stat">
                        <div class="stat-header">
                            <div class="stat-label">
                                <i class="fas fa-seedling"></i>
                                <span>Soil Quality</span>
                            </div>
                            <span id="soil-value">50%</span>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar soil-progress" id="soil-bar" style="width: 50%"></div>
                        </div>
                    </div>
                    
                    <div class="stat">
                        <div class="stat-header">
                            <div class="stat-label">
                                <i class="fas fa-bug"></i>
                                <span>Pest Risk</span>
                            </div>
                            <span id="pest-value">20%</span>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar pest-progress" id="pest-bar" style="width: 20%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="message" id="message">
                    Welcome to your plant care journey! Start by watering your plant.
                </div>
            </div>
        </div>
        
        <div class="stage-indicator">
            <div class="stage active" id="stage-seed">
                <i class="fas fa-seedling"></i>
                <div>Seed</div>
            </div>
            <div class="stage" id="stage-sprout">
                <i class="fas fa-leaf"></i>
                <div>Sprout</div>
            </div>
            <div class="stage" id="stage-mature">
                <i class="fas fa-tree"></i>
                <div>Mature</div>
            </div>
        </div>
        
        <div class="status-bar">
            <div>Project: Virtual Plant Care Simulator</div>
            <div>Tech: Pyodide, HTML5 Canvas</div>
            <div>GitHub: Ready for Deployment</div>
        </div>
    </div>

    <script>
        // Global variables
        let pyodide;
        let plantStage = 0; // 0: seed, 1: sprout, 2: mature
        let stats = { water: 50, sunlight: 50, soil: 50, pestRisk: 20 };
        let weather = 'sunny';
        let plantHealth = 100;
        let messages = [
            "Your plant is looking great!",
            "Plants need regular care to thrive.",
            "Try different care techniques!",
            "Watch out for pests!",
            "Your plant is growing nicely!",
            "Sunlight is essential for growth.",
            "Good soil makes healthy plants.",
            "Water is life for your plant."
        ];
        
        // DOM elements
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const loadingScreen = document.getElementById('loading');
        
        // Initialize the app
        async function loadPyodideAndRun() {
            // Show loading screen
            loadingScreen.style.display = 'flex';
            
            try {
                // Load Pyodide
                pyodide = await loadPyodide();
                
                // Load Python code
                await pyodide.runPythonAsync(`
import random
import math

plant_names = ["Sunflower", "Rose", "Tulip", "Cactus", "Fern", "Orchid"]

def get_random_plant_name():
    return random.choice(plant_names)

def apply_care(action, stats):
    if action == 'water':
        stats['water'] = min(100, stats['water'] + random.randint(15, 25))
    elif action == 'sunlight':
        stats['sunlight'] = min(100, stats['sunlight'] + random.randint(15, 25))
    elif action == 'soil':
        stats['soil'] = min(100, stats['soil'] + random.randint(15, 25))
    elif action == 'pest':
        stats['pestRisk'] = max(0, stats['pestRisk'] - random.randint(15, 25))
    
    # Update plant health based on care
    health_boost = 0
    if action == 'water':
        health_boost = 5
    elif action == 'sunlight':
        health_boost = 4
    elif action == 'soil':
        health_boost = 6
    elif action == 'pest':
        health_boost = 7
    
    return health_boost

def update_weather():
    weathers = ['sunny', 'rainy', 'cloudy', 'windy']
    return random.choice(weathers)

def update_growth(stats):
    # Calculate growth factor based on stats
    growth_factor = (stats['water'] * 0.3 + stats['sunlight'] * 0.3 + stats['soil'] * 0.4) - (stats['pestRisk'] * 0.5)
    
    # Determine plant stage
    if growth_factor > 70:
        return 2  # Mature
    elif growth_factor > 40:
        return 1  # Sprout
    return 0  # Seed

def update_stats(stats):
    # Degrade stats over time
    stats['water'] = max(0, stats['water'] - random.randint(1, 3))
    stats['sunlight'] = max(0, stats['sunlight'] - random.randint(1, 3))
    stats['soil'] = max(0, stats['soil'] - random.randint(1, 2))
    
    # Pest risk increases over time
    stats['pestRisk'] = min(100, stats['pestRisk'] + random.randint(1, 3))
    
    # Calculate health impact
    health_impact = 0
    if stats['water'] < 30:
        health_impact -= random.randint(1, 3)
    if stats['sunlight'] < 30:
        health_impact -= random.randint(1, 3)
    if stats['soil'] < 30:
        health_impact -= random.randint(1, 3)
    if stats['pestRisk'] > 50:
        health_impact -= random.randint(2, 5)
    
    return health_impact
                `);
                
                // Initialize plant name
                const plantName = pyodide.globals.get_random_plant_name();
                document.getElementById('plant-name').textContent = plantName;
                
                // Draw initial plant
                drawPlant();
                updateDashboard();
                
                // Hide loading screen
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    showMessage("Your plant care journey begins! Start by watering your plant.");
                }, 1500);
                
                // Start game loops
                setInterval(updateWeather, 10000); // Update weather every 10 seconds
                setInterval(degradeStats, 3000);   // Degrade stats every 3 seconds
                
            } catch (error) {
                console.error("Error loading Pyodide:", error);
                loadingScreen.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <h2>Error Loading Simulator</h2>
                        <p>Failed to load Pyodide environment.</p>
                        <p>${error.message}</p>
                        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #98FB98; border: none; border-radius: 5px; cursor: pointer;">Try Again</button>
                    </div>
                `;
            }
        }
        
        // Draw plant based on current stage
        function drawPlant() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw sky
            drawSky();
            
            // Draw ground
            drawGround();
            
            // Draw plant based on stage
            const x = canvas.width / 2;
            const y = canvas.height - 50;
            
            if (plantStage === 0) {  // Seed
                drawSeed(x, y);
                updateStageIndicator(0);
            } else if (plantStage === 1) {  // Sprout
                drawSprout(x, y);
                updateStageIndicator(1);
            } else if (plantStage === 2) {  // Mature
                drawMaturePlant(x, y);
                updateStageIndicator(2);
            }
        }
        
        // Draw sky with weather effect
        function drawSky() {
            // Sky gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            
            if (weather === 'sunny') {
                gradient.addColorStop(0, '#87CEEB');
                gradient.addColorStop(1, '#E0F7FA');
                
                // Draw sun
                ctx.beginPath();
                ctx.arc(100, 80, 50, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255, 255, 0, 0.8)';
                ctx.fill();
                
                // Sun rays
                for (let i = 0; i < 12; i++) {
                    const angle = (i * 30) * Math.PI / 180;
                    const length = 70;
                    ctx.beginPath();
                    ctx.moveTo(100 + 50 * Math.cos(angle), 80 + 50 * Math.sin(angle));
                    ctx.lineTo(100 + (50 + length) * Math.cos(angle), 80 + (50 + length) * Math.sin(angle));
                    ctx.strokeStyle = 'rgba(255, 255, 0, 0.6)';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                }
                
            } else if (weather === 'rainy') {
                gradient.addColorStop(0, '#4682B4');
                gradient.addColorStop(1, '#708090');
                
                // Draw clouds
                drawCloud(150, 70, 40);
                drawCloud(250, 90, 50);
                drawCloud(350, 60, 45);
                
                // Draw rain
                for (let i = 0; i < 50; i++) {
                    const x = Math.random() * canvas.width;
                    const y = Math.random() * canvas.height;
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.lineTo(x - 5, y + 15);
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.7)';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
                
            } else if (weather === 'cloudy') {
                gradient.addColorStop(0, '#778899');
                gradient.addColorStop(1, '#B0C4DE');
                
                // Draw clouds
                drawCloud(100, 70, 60);
                drawCloud(300, 90, 70);
                drawCloud(500, 60, 50);
                
            } else { // windy
                gradient.addColorStop(0, '#5F9EA0');
                gradient.addColorStop(1, '#B0E0E6');
                
                // Draw wind lines
                for (let i = 0; i < 20; i++) {
                    const x = Math.random() * canvas.width;
                    const y = Math.random() * canvas.height;
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.lineTo(x + 30, y - 10);
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
        
        function drawCloud(x, y, size) {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.beginPath();
            ctx.arc(x, y, size * 0.6, 0, Math.PI * 2);
            ctx.arc(x + size * 0.5, y - size * 0.2, size * 0.5, 0, Math.PI * 2);
            ctx.arc(x + size * 0.9, y, size * 0.6, 0, Math.PI * 2);
            ctx.arc(x + size * 0.5, y + size * 0.2, size * 0.5, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawGround() {
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(0, canvas.height - 50, canvas.width, 50);
            
            // Draw grass
            ctx.fillStyle = '#2E8B57';
            for (let i = 0; i < 50; i++) {
                const x = Math.random() * canvas.width;
                const height = 10 + Math.random() * 15;
                ctx.fillRect(x, canvas.height - 50, 3, -height);
            }
        }
        
        function drawSeed(x, y) {
            // Seed body
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.ellipse(x, y, 15, 10, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Seed highlight
            ctx.fillStyle = '#A0522D';
            ctx.beginPath();
            ctx.ellipse(x - 5, y - 3, 5, 3, 0, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawSprout(x, y) {
            // Stem
            ctx.fillStyle = '#228B22';
            ctx.fillRect(x - 5, y - 50, 10, 50);
            
            // Leaves
            ctx.fillStyle = '#32CD32';
            drawLeaf(x, y - 40, -30, 20);
            drawLeaf(x, y - 40, 30, 20);
            
            // Bud
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(x, y - 55, 8, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawLeaf(x, y, angle, size) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle * Math.PI / 180);
            
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.quadraticCurveTo(size, -size/2, size, 0);
            ctx.quadraticCurveTo(size, size/2, 0, 0);
            ctx.fillStyle = '#32CD32';
            ctx.fill();
            
            ctx.restore();
        }
        
        function drawMaturePlant(x, y) {
            // Stem
            ctx.fillStyle = '#006400';
            ctx.fillRect(x - 8, y - 120, 16, 120);
            
            // Leaves
            ctx.fillStyle = '#32CD32';
            drawLeaf(x, y - 40, -30, 30);
            drawLeaf(x, y - 80, 30, 30);
            drawLeaf(x, y - 60, -60, 25);
            drawLeaf(x, y - 100, 60, 25);
            
            // Flower
            ctx.fillStyle = '#FF6347';
            for (let i = 0; i < 8; i++) {
                const angle = (i * 45) * Math.PI / 180;
                const petalX = x + 25 * Math.cos(angle);
                const petalY = y - 140 + 25 * Math.sin(angle);
                ctx.beginPath();
                ctx.ellipse(petalX, petalY, 15, 8, angle, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Flower center
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(x, y - 140, 12, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function updateStageIndicator(stage) {
            document.querySelectorAll('.stage').forEach((el, idx) => {
                if (idx === stage) {
                    el.classList.add('active');
                } else {
                    el.classList.remove('active');
                }
            });
        }
        
        function updateWeather() {
            weather = pyodide.globals.update_weather();
            
            // Update weather display
            const weatherDisplay = document.getElementById('weather-display');
            let icon, text;
            
            switch (weather) {
                case 'sunny':
                    icon = '<i class="fas fa-sun"></i>';
                    text = 'Sunny';
                    break;
                case 'rainy':
                    icon = '<i class="fas fa-cloud-rain"></i>';
                    text = 'Rainy';
                    break;
                case 'cloudy':
                    icon = '<i class="fas fa-cloud"></i>';
                    text = 'Cloudy';
                    break;
                case 'windy':
                    icon = '<i class="fas fa-wind"></i>';
                    text = 'Windy';
                    break;
            }
            
            weatherDisplay.innerHTML = `${icon} <span>${text}</span>`;
            
            // Redraw to show weather effects
            drawPlant();
        }
        
        function care(action) {
            // Apply care action
            const healthBoost = pyodide.globals.apply_care(action, stats);
            plantHealth = Math.min(100, plantHealth + healthBoost);
            
            // Update plant stage
            plantStage = pyodide.globals.update_growth(stats);
            
            // Visual feedback
            const btn = document.querySelector(`.care-btn.${action}`);
            btn.style.animation = 'pulse 0.5s';
            setTimeout(() => {
                btn.style.animation = '';
            }, 500);
            
            // Show message
            let message;
            switch (action) {
                case 'water': 
                    message = "You watered the plant! Hydration is important for growth."; 
                    break;
                case 'sunlight': 
                    message = "Sunlight provided! Plants need light for photosynthesis."; 
                    break;
                case 'soil': 
                    message = "Soil improved! Nutrients are essential for healthy roots."; 
                    break;
                case 'pest': 
                    message = "Pests controlled! Protecting your plant from invaders."; 
                    break;
            }
            showMessage(message);
            
            // Update display
            drawPlant();
            updateDashboard();
        }
        
        function degradeStats() {
            // Degrade stats over time
            const healthImpact = pyodide.globals.update_stats(stats);
            plantHealth = Math.max(0, plantHealth + healthImpact);
            
            // Update plant stage
            plantStage = pyodide.globals.update_growth(stats);
            
            // Show message if stats are critical
            if (stats.water < 20) {
                showMessage("Warning: Your plant is thirsty! Water it soon.");
            } else if (stats.sunlight < 20) {
                showMessage("Warning: Your plant needs more sunlight!");
            } else if (stats.soil < 20) {
                showMessage("Warning: Soil quality is low! Improve the soil.");
            } else if (stats.pestRisk > 60) {
                showMessage("Warning: Pest risk is high! Control pests soon.");
            }
            
            // Update display
            drawPlant();
            updateDashboard();
        }
        
        function updateDashboard() {
            // Update progress bars
            document.getElementById('water-bar').style.width = `${stats.water}%`;
            document.getElementById('sunlight-bar').style.width = `${stats.sunlight}%`;
            document.getElementById('soil-bar').style.width = `${stats.soil}%`;
            document.getElementById('pest-bar').style.width = `${stats.pestRisk}%`;
            
            // Update values
            document.getElementById('water-value').textContent = `${Math.round(stats.water)}%`;
            document.getElementById('sunlight-value').textContent = `${Math.round(stats.sunlight)}%`;
            document.getElementById('soil-value').textContent = `${Math.round(stats.soil)}%`;
            document.getElementById('pest-value').textContent = `${Math.round(stats.pestRisk)}%`;
        }
        
        function showMessage(text) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.style.opacity = 1;
            
            // Fade out after 4 seconds
            setTimeout(() => {
                messageEl.style.opacity = 0.7;
            }, 4000);
        }
        
        // Initialize the app
        loadPyodideAndRun();
    </script>
</body>
</html>
